<?php

namespace AppBundle\Repository;

/**
 * ObjectRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ObjectRepository extends \Doctrine\ORM\EntityRepository
{
	//Rechercher et renvoi les objets avec leurs categories qui ont ete mit en ligne dans une periode donnee par $start et $end
	public function findByUploadDateRangeWithCategory(\DateTime $start, \DateTime $end){
		$qb = $this
		->createQueryBuilder('o')
		->innerJoin('o.objectCategoryId','cat')
		->addSelect('cat');
		;

		$qb
		->where('o.objectUploadDate >= :start')
		->setParameter('start', $start)
		->andWhere('o.objectUploadDate <= :end')
		->setParameter('end', $end)
		->orderBy('o.objectUploadDate','DESC');

		return $qb->getQuery()->getResult();
	}
	//Rechercher et renvoi les objets qui sont d une certaine categorie passe en parametre avec $categoryFilter
	public function getObjectsWithCategory(array $categoryFilter){
		$qb = $this
		->createQueryBuilder('o')
		->innerJoin('o.objectCategoryId','cat')
		->addSelect('cat')
		;

		$qb->where($qb->expr()->in('o.objectCategoryId', $categoryFilter));

		return $qb
		->getQuery()
		->getResult()
		;
	}
}

?>